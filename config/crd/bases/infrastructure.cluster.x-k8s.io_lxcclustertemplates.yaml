---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.4
  name: lxcclustertemplates.infrastructure.cluster.x-k8s.io
spec:
  group: infrastructure.cluster.x-k8s.io
  names:
    kind: LXCClusterTemplate
    listKind: LXCClusterTemplateList
    plural: lxcclustertemplates
    singular: lxcclustertemplate
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Time duration since creation of LXCClusterTemplate
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: LXCClusterTemplate is the Schema for the lxcclustertemplates
          API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: LXCClusterTemplateSpec defines the desired state of LXCClusterTemplate.
            properties:
              template:
                description: LXCClusterTemplateResource describes the data needed
                  to create a LXCCluster from a template.
                properties:
                  metadata:
                    description: |-
                      Standard object's metadata.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata
                    properties:
                      annotations:
                        additionalProperties:
                          type: string
                        description: |-
                          annotations is an unstructured key value map stored with a resource that may be
                          set by external tools to store and retrieve arbitrary metadata. They are not
                          queryable and should be preserved when modifying objects.
                          More info: http://kubernetes.io/docs/user-guide/annotations
                        type: object
                      labels:
                        additionalProperties:
                          type: string
                        description: |-
                          Map of string keys and values that can be used to organize and categorize
                          (scope and select) objects. May match selectors of replication controllers
                          and services.
                          More info: http://kubernetes.io/docs/user-guide/labels
                        type: object
                    type: object
                  spec:
                    description: LXCClusterSpec defines the desired state of LXCCluster.
                    properties:
                      controlPlaneEndpoint:
                        description: ControlPlaneEndpoint represents the endpoint
                          to communicate with the control plane.
                        properties:
                          host:
                            description: The hostname on which the API server is serving.
                            type: string
                          port:
                            description: The port on which the API server is serving.
                            format: int32
                            type: integer
                        required:
                        - host
                        - port
                        type: object
                      loadBalancer:
                        description: LoadBalancer is configuration for provisioning
                          the load balancer of the cluster.
                        properties:
                          instanceSpec:
                            description: InstanceSpec can be used to adjust the load
                              balancer instance when using the "lxc" or "oci" load
                              balancer type.
                            properties:
                              flavor:
                                description: |-
                                  Flavor is configuration for the instance size (e.g. t3.micro, or c2-m4).

                                  Examples:
                                    - `t3.micro` -- match specs of an EC2 t3.micro instance
                                    - `c2-m4` -- 2 cores, 4 GB RAM
                                type: string
                              image:
                                description: |-
                                  Image to use for provisioning the load balancer machine. If not set,
                                  a default image based on the load balancer type will be used.

                                    - "oci": ghcr.io/neoaggelos/cluster-api-provider-lxc/haproxy:v0.0.1
                                    - "lxc": haproxy from the default simplestreams server
                                properties:
                                  fingerprint:
                                    description: Fingerprint is the image fingerprint.
                                    type: string
                                  name:
                                    description: Name is the image name or alias.
                                    type: string
                                  protocol:
                                    description: Protocol is the protocol to use for
                                      fetching the image, e.g. "simplestreams".
                                    type: string
                                  server:
                                    description: Server is the remote server, e.g.
                                      "https://images.linuxcontainers.org"
                                    type: string
                                type: object
                              profiles:
                                description: Profiles is a list of profiles to attach
                                  to the instance.
                                items:
                                  type: string
                                type: array
                            type: object
                          ovnNetworkName:
                            description: OVNNetworkName is the name of the OVN network
                              to use when using the "network" load balancer type.
                            type: string
                          type:
                            description: |-
                              Type of load balancer to provision for the cluster.

                                - "lxc" will spin up a plain Ubuntu LXC with haproxy installed.

                                  The controller will automatically update the list of backends on the
                                  haproxy configuration control plane nodes are added or removed from
                                  the cluster.

                                  No other configuration is required for "lxc" mode. The load balancer
                                  instance can be configured through .spec.loadBalancer.instanceSpec.

                                - "external" will not create any load balancer. Should be used alongside
                                  something like kube-vip, otherwise the cluster will fail to provision.

                                  When using "external" mode, the load balancer address must be set in
                                  .spec.controlPlaneEndpoint.host on the LXCCluster object.

                                - "oci" will spin up an OCI instance running haproxy using the kind
                                  haproxy image.

                                  The controller will automatically update the list of backends on the
                                  haproxy configuration control plane nodes are added or removed from
                                  the cluster.

                                  No other configuration is required for "oci" mode. The load balancer
                                  instance can be configured through .spec.loadBalancer.instanceSpec.

                                  Requires server extensions: "instance_oci"

                                - "network" will create a network load balancer.

                                  The controller will automatically update the list of backends on the
                                  haproxy configuration control plane nodes are added or removed from
                                  the cluster.

                                  When using "network" mode, the load balancer address must be set in
                                  .spec.controlPlaneEndpoint.host on the LXCCluster object. In addition,
                                  the ovn network to use must be set in .spec.loadBalancer.ovnNetworkName.
                                  The cluster administrator is responsible to ensure that the OVN network
                                  is configured and that the LXCMachineTemplate objects have appropriate
                                  profiles to use the OVN network.

                                  Requires server extensions: "network_load_balancer"

                                  Optional server extensions: "network_load_balancer_health_checks"
                            enum:
                            - lxc
                            - external
                            - oci
                            - network
                            type: string
                        type: object
                      secretRef:
                        description: SecretRef references a secret with credentials
                          to access the LXC (e.g. Incus, LXD) server.
                        properties:
                          name:
                            description: Name is the name of the secret to use. The
                              secret must already exist in the same namespace as the
                              parent object.
                            type: string
                        required:
                        - name
                        type: object
                      serverType:
                        description: |-
                          ServerType is "incus" or "lxd". This makes it simpler for the LXCCluster
                          and LXCMachine controllers to work with both implementations, as some
                          defaults (e.g. remotes for pulling images) are not compatible.

                          If left unset, will be automatically set by the LXCCluster controller while
                          provisioning the cluster.
                        enum:
                        - incus
                        - lxd
                        - unknown
                        - ""
                        type: string
                      skipDefaultKubeadmProfile:
                        description: |-
                          Running Kubernetes on LXC requires an LXC profile enabling privileged
                          containers and similar configuration. By default, a profile with name
                          "cluster-api-$namespace-$name" profile is created and associated with
                          all created Machines automatically.

                          This option can be used to disable this behavior. In that case, the cluster
                          administrator is responsible to create the LXC profile and specify it in
                          the .spec.template.spec.profiles field of the LXCMachineTemplate objects.

                          This is useful in cases where a limited project is used, which does not
                          allow privileged containers.
                        type: boolean
                    required:
                    - loadBalancer
                    type: object
                required:
                - spec
                type: object
            required:
            - template
            type: object
        type: object
    served: true
    storage: true
    subresources: {}
